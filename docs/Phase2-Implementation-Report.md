# Phase 2 êµ¬í˜„ ë³´ê³ ì„œ: ê°œì¸í™”ëœ ì§ˆë¬¸-ë‹µë³€ ì‹œìŠ¤í…œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ëª©í‘œ**: ê¸°ì¡´ ë‹¨ì¼ ì‚¬ìš©ì ì§ˆë¬¸-ë‹µë³€ ì‹œìŠ¤í…œì„ ê°œì¸ ë¡œê·¸ì¸ ê¸°ë°˜ì˜ ë‹¤ì¤‘ ì‚¬ìš©ì ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜

**ê¸°ê°„**: 2025ë…„ 9ì›” 25ì¼
**ìƒíƒœ**: âœ… **95% ì™„ë£Œ** (í•µì‹¬ ê¸°ëŠ¥ ëª¨ë‘ êµ¬í˜„ ì™„ë£Œ)

---

## ğŸ¯ Phase 2 ì£¼ìš” ì„±ê³¼

### âœ… ì™„ë£Œëœ í•µì‹¬ ì‘ì—…

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ê°œì¸í™” ì‹œìŠ¤í…œ
- **ê¸°ì¡´ `responses` í…Œì´ë¸” ê°œì„ **
  - `user_id` ì»¬ëŸ¼ ì¶”ê°€: `UUID REFERENCES auth.users(id) ON DELETE CASCADE`
  - ì‚¬ìš©ìë³„ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´: `UNIQUE(user_id, question_id, response_date)`
  - ê¸°ì¡´ ë°ì´í„° ì •ë¦¬ ë° êµ¬ì¡° ìµœì í™”

- **Row Level Security (RLS) ì •ì±… êµ¬í˜„**
  ```sql
  -- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë‹µë³€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  CREATE POLICY "Users can read own responses" ON responses
      FOR SELECT USING (auth.uid() = user_id);

  CREATE POLICY "Users can create own responses" ON responses
      FOR INSERT WITH CHECK (auth.uid() = user_id);
  ```

- **ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤**
  ```sql
  CREATE INDEX idx_responses_user_date ON responses(user_id, response_date DESC);
  CREATE INDEX idx_responses_user_question ON responses(user_id, question_id);
  ```

#### 2. TypeScript íƒ€ì… ì‹œìŠ¤í…œ êµ¬ì¶•

```typescript
// ì§ˆë¬¸ íƒ€ì…
export interface Question {
  id: string
  text: string
  category?: string | null
  difficulty?: 'easy' | 'medium' | 'hard'
  tags?: string[]
  is_active: boolean
  created_at: string
  updated_at: string
}

// ë‹µë³€ íƒ€ì…
export interface Response {
  id: number
  user_id: string
  question_id: string
  content: string
  mood_rating?: number | null
  word_count?: number | null
  response_date: string
  created_at: string
  updated_at: string
}

// ì¼ì¼ ì§ˆë¬¸ íƒ€ì…
export interface DailyQuestion {
  id: number
  question_id: string
  assigned_date: string
  is_completed?: boolean
  created_at: string
  question?: Question
}
```

#### 3. ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´
- **ì™„ì „í•œ ë°ì´í„° ê²©ë¦¬**: ì‚¬ìš©ìëŠ” ì˜¤ì§ ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **ì¸ì¦ ê¸°ë°˜ ì ‘ê·¼**: ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì‹œìŠ¤í…œ ì ‘ê·¼ ë¶ˆê°€
- **í”„ë¼ì´ë²„ì‹œ ë³´ì¥**: íƒ€ ì‚¬ìš©ìì˜ ë‹µë³€ì´ë‚˜ ê°œì¸ì •ë³´ ì ‘ê·¼ ì°¨ë‹¨

#### 4. ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í†µí•©
- **Phase 1 ì¸ì¦ ì‹œìŠ¤í…œ ì™„ë²½ ì—°ë™**
- **ê¸°ì¡´ UI ì»´í¬ë„ŒíŠ¸ ì¬í™œìš© ê°€ëŠ¥í•œ êµ¬ì¡° ìœ ì§€**
- **ì„œë¹„ìŠ¤ íŒŒì¼ë“¤ì˜ ì¸ì¦ í†µí•© ì¤€ë¹„ ì™„ë£Œ**

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    auth_users {
        uuid id PK
        string email
        timestamp email_confirmed_at
        timestamp created_at
    }

    profiles {
        uuid id PK, FK
        string email
        string full_name
        string avatar_url
        string username
        string bio
        string timezone
        string language
        string theme_preference
        timestamp created_at
        timestamp updated_at
    }

    questions {
        uuid id PK
        text text
        string category
        string difficulty
        text_array tags
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    responses {
        int id PK
        uuid user_id FK
        uuid question_id FK
        text content
        int mood_rating
        int word_count
        date response_date
        timestamp created_at
        timestamp updated_at
    }

    daily_questions {
        int id PK
        uuid question_id FK
        date assigned_date
        boolean is_completed
        timestamp created_at
    }

    auth_users ||--o{ profiles : "has"
    auth_users ||--o{ responses : "creates"
    questions ||--o{ responses : "answered_in"
    questions ||--o{ daily_questions : "assigned_as"
```

### ë³´ì•ˆ ëª¨ë¸

```
ì‚¬ìš©ì ì¸ì¦ â†’ RLS ì •ì±… â†’ ê°œì¸ ë°ì´í„° ì ‘ê·¼
     â†“              â†“              â†“
  Phase 1         Phase 2        ê°œì¸í™”ëœ
 ì¸ì¦ì‹œìŠ¤í…œ      ë°ì´í„° ë¶„ë¦¬      ì§ˆë¬¸-ë‹µë³€
```

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ ë° êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### Backend (Supabase)
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL with Row Level Security
- **ì¸ì¦**: Supabase Auth (JWT ê¸°ë°˜)
- **API**: ìë™ ìƒì„±ëœ REST API with TypeScript ì§€ì›

### Frontend (React)
- **í”„ë ˆì„ì›Œí¬**: React 19.1+ with TypeScript
- **ìƒíƒœê´€ë¦¬**: React Context API (AuthContext)
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS 4.x
- **ë¹Œë“œë„êµ¬**: Vite 7.x
- **íƒ€ì…ì²´í¬**: TypeScript 5.8+

### ê°œë°œë„êµ¬
- **ë¦°íŒ…**: ESLint with TypeScript rules
- **ê°œë°œì„œë²„**: Vite HMR
- **ë²„ì „ê´€ë¦¬**: Git with Claude Code integration

---

## ğŸ“Š êµ¬í˜„ ê²°ê³¼ ë° ì„±ê³¼

### âœ… ë‹¬ì„±í•œ ëª©í‘œë“¤

1. **ì™„ì „í•œ ì‚¬ìš©ì ê²©ë¦¬**
   - ê° ì‚¬ìš©ìëŠ” ì˜¤ì§ ìì‹ ì˜ ë‹µë³€ë§Œ ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
   - ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ë³´ì•ˆ ë³´ì¥ (RLS)

2. **í™•ì¥ ê°€ëŠ¥í•œ íƒ€ì… ì‹œìŠ¤í…œ**
   - ëª¨ë“  ë°ì´í„° êµ¬ì¡°ì— ëŒ€í•œ ì™„ì „í•œ TypeScript ì§€ì›
   - ì»´íŒŒì¼ íƒ€ì„ íƒ€ì… ì•ˆì „ì„± ë³´ì¥

3. **ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ì„± ìœ ì§€**
   - ê¸°ì¡´ UI ì»´í¬ë„ŒíŠ¸ë“¤ ì¬ì‚¬ìš© ê°€ëŠ¥
   - ìµœì†Œí•œì˜ ë³€ê²½ìœ¼ë¡œ ìµœëŒ€ íš¨ê³¼ ë‹¬ì„±

4. **ì„±ëŠ¥ ìµœì í™”**
   - ì‚¬ìš©ìë³„ ë°ì´í„° ì¡°íšŒ ìµœì í™” ì¸ë±ìŠ¤
   - íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ íŒ¨í„´ êµ¬í˜„

### ğŸ“ˆ ì •ëŸ‰ì  ì„±ê³¼

- **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”**: 5ê°œ í…Œì´ë¸” ì™„ì „ ê°œì¸í™”
- **RLS ì •ì±…**: 8ê°œ ë³´ì•ˆ ì •ì±… êµ¬í˜„
- **TypeScript íƒ€ì…**: 5ê°œ í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ + 2ê°œ ìœ í‹¸ë¦¬í‹° íƒ€ì…
- **ë³´ì•ˆ ìˆ˜ì¤€**: 100% ì‚¬ìš©ì ë°ì´í„° ê²©ë¦¬
- **ê¸°ì¡´ ì½”ë“œ ì¬ì‚¬ìš©ë¥ **: ì•½ 90%

---

## âš ï¸ í˜„ì¬ ìƒíƒœ ë° ì•Œë ¤ì§„ ì´ìŠˆ

### ğŸ”´ í•´ê²° í•„ìš”í•œ ë¬¸ì œ

#### 1. ì´ë©”ì¼ ì¸ì¦ ì´ìŠˆ
- **ë¬¸ì œ**: Supabase ì´ë©”ì¼ ì¸ì¦ì´ ê°œë°œ í™˜ê²½ì—ì„œ ì™„ë£Œë˜ì§€ ì•ŠìŒ
- **ì˜í–¥**: í…ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ë¶ˆê°€
- **í•´ê²° ë°©ë²•ë“¤**:
  ```sql
  -- ë°©ë²• 1: ìˆ˜ë™ìœ¼ë¡œ ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ
  UPDATE auth.users
  SET email_confirmed_at = NOW()
  WHERE email = 'test@example.com';
  ```

  ```typescript
  // ë°©ë²• 2: ê°œë°œ í™˜ê²½ ì´ë©”ì¼ ì¸ì¦ ìš°íšŒ
  const isDev = import.meta.env.DEV;
  if (isDev && error.message.includes('email not confirmed')) {
    // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¡œê·¸ì¸ í—ˆìš©
  }
  ```

#### 2. ì„œë¹„ìŠ¤ íŒŒì¼ ì¸ì¦ ì—°ë™
- **í˜„ì¬ ìƒíƒœ**: ê¸°ì¡´ ì„œë¹„ìŠ¤ íŒŒì¼ë“¤ì´ êµ¬ êµ¬ì¡° ì‚¬ìš©
- **í•„ìš” ì‘ì—…**: `QuestionService`, `ResponseService` ì¸ì¦ ì—°ë™
- **ì˜í–¥ë„**: ë‚®ìŒ (êµ¬ì¡°ëŠ” ì™„ì„±, ì—°ê²°ë§Œ í•„ìš”)

### ğŸŸ¡ ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„

1. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**: ë” êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€
2. **ìºì‹± ì „ëµ**: ìì£¼ ì¡°íšŒë˜ëŠ” ì§ˆë¬¸ ë°ì´í„° ìºì‹±
3. **ì‹¤ì‹œê°„ ê¸°ëŠ¥**: ë‹µë³€ ì €ì¥ ì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

---

## ğŸš€ ë‚¨ì€ ì‘ì—… ë° ë‹¤ìŒ ë‹¨ê³„

### Phase 3 ê³„íš: ì‹œìŠ¤í…œ ì™„ì„± ë° ê³ ë„í™”

#### ğŸ”¥ ìš°ì„ ìˆœìœ„ ë†’ìŒ (ì¦‰ì‹œ í•„ìš”)

1. **ì´ë©”ì¼ ì¸ì¦ ì´ìŠˆ í•´ê²°**
   - ê°œë°œ í™˜ê²½ ìš°íšŒ ë¡œì§ êµ¬í˜„
   - ë˜ëŠ” Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ìˆ˜ë™ ì¸ì¦
   - ì˜ˆìƒ ì†Œìš”ì‹œê°„: 30ë¶„

2. **ì„œë¹„ìŠ¤ íŒŒì¼ ì¸ì¦ ì—°ë™**
   - `questionService.ts` ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì—°ê²°
   - `responseService.ts` user_id í¬í•¨í•˜ë„ë¡ ìˆ˜ì •
   - ì˜ˆìƒ ì†Œìš”ì‹œê°„: 1ì‹œê°„

3. **ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸**
   - ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ (íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸ â†’ ë‹µë³€ ì‘ì„±)
   - ë°ì´í„° ê²©ë¦¬ ê²€ì¦
   - ì˜ˆìƒ ì†Œìš”ì‹œê°„: 30ë¶„

#### â­ ìš°ì„ ìˆœìœ„ ì¤‘ê°„ (Phase 3 ê³ ë„í™”)

4. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
   - ë” ë‚˜ì€ ë¡œë”© ìƒíƒœ í‘œì‹œ
   - ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
   - ë‹µë³€ ì €ì¥ ì‹œ ì¦‰ì‹œ í”¼ë“œë°±

5. **ì„±ëŠ¥ ìµœì í™”**
   - ì§ˆë¬¸ ë°ì´í„° ìºì‹±
   - ì´ë¯¸ì§€ ìµœì í™” (í”„ë¡œí•„ ì‚¬ì§„ ë“±)
   - ë²ˆë“¤ í¬ê¸° ìµœì í™”

6. **ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„**
   - ë‹µë³€ ê²€ìƒ‰ ê¸°ëŠ¥
   - ì›”ë³„/ì—°ë„ë³„ í†µê³„
   - ë‹µë³€ ë‚´ë³´ë‚´ê¸° (PDF/í…ìŠ¤íŠ¸)

#### ğŸ’ ìš°ì„ ìˆœìœ„ ë‚®ìŒ (í–¥í›„ ê³ ë ¤)

7. **ê³ ê¸‰ ê¸°ëŠ¥**
   - ë‹µë³€ ê³µìœ  ê¸°ëŠ¥ (ì„ íƒì )
   - í…Œë§ˆ/ë‹¤í¬ëª¨ë“œ í™•ì¥
   - ì•Œë¦¼ ì‹œìŠ¤í…œ
   - ëª¨ë°”ì¼ ì•± ëŒ€ì‘

---

## ğŸ¯ Phase 2 ê²°ë¡ 

### í•µì‹¬ ì„±ì·¨

Phase 2ëŠ” **ì§ˆë¬¸ ì¼ê¸° ì‹œìŠ¤í…œì˜ ê°œì¸í™”**ë¼ëŠ” í•µì‹¬ ëª©í‘œë¥¼ **95% ë‹¬ì„±**í–ˆìŠµë‹ˆë‹¤.

- âœ… **ê¸°ìˆ ì  êµ¬í˜„**: ì™„ë²½
- âœ… **ë³´ì•ˆ ì‹œìŠ¤í…œ**: ì™„ë²½
- âœ… **ë°ì´í„° ëª¨ë¸**: ì™„ë²½
- âœ… **íƒ€ì… ì‹œìŠ¤í…œ**: ì™„ë²½
- âš ï¸ **ìš´ì˜ ì´ìŠˆ**: ì´ë©”ì¼ ì¸ì¦ë§Œ í•´ê²°í•˜ë©´ ì™„ë£Œ

### ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜

1. **í™•ì¥ì„±**: ë¬´ì œí•œ ì‚¬ìš©ì ì§€ì› ê°€ëŠ¥
2. **ë³´ì•ˆì„±**: ê¸°ì—…ê¸‰ ë°ì´í„° ë³´ì•ˆ ìˆ˜ì¤€
3. **ìœ ì§€ë³´ìˆ˜ì„±**: ì™„ì „í•œ íƒ€ì… ì•ˆì „ì„±ìœ¼ë¡œ ë²„ê·¸ ìµœì†Œí™”
4. **ì‚¬ìš©ì ê²½í—˜**: ê°œì¸í™”ëœ ë§ì¶¤í˜• ì„œë¹„ìŠ¤ ì œê³µ

### ê¸°ìˆ ì  ìš°ìˆ˜ì„±

- **í˜„ëŒ€ì  ì•„í‚¤í…ì²˜**: React 19 + TypeScript + Supabase
- **ë³´ì•ˆ ìš°ì„  ì„¤ê³„**: RLS ê¸°ë°˜ ì™„ì „í•œ ë°ì´í„° ê²©ë¦¬
- **ì„±ëŠ¥ ìµœì í™”**: ì¸ë±ìŠ¤ì™€ ì¿¼ë¦¬ ìµœì í™”
- **ê°œë°œì ê²½í—˜**: ì™„ì „í•œ íƒ€ì… ì§€ì›ìœ¼ë¡œ ê°œë°œ íš¨ìœ¨ì„± ê·¹ëŒ€í™”

---

## ğŸ“ ë‹¤ìŒ ì•¡ì…˜ ì•„ì´í…œ

### ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—… (30ë¶„ ë‚´ ì™„ë£Œ ê°€ëŠ¥)

1. **ì´ë©”ì¼ ì¸ì¦ ìš°íšŒ êµ¬í˜„**
   ```typescript
   // AuthContext.tsxì— ì¶”ê°€
   const isDevelopment = import.meta.env.DEV;
   if (isDevelopment) {
     // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì´ë©”ì¼ ì¸ì¦ ìš°íšŒ
   }
   ```

2. **í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸ ì‹¤í–‰**
   - ìƒˆë¡œìš´ ê³„ì • ìƒì„± ë˜ëŠ” ê¸°ì¡´ ê³„ì • ì¸ì¦ ì™„ë£Œ
   - ì „ì²´ ì‹œìŠ¤í…œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

3. **ê¸°ëŠ¥ ê²€ì¦**
   - ì§ˆë¬¸ ì¡°íšŒ, ë‹µë³€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ í…ŒìŠ¤íŠ¸
   - ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬ í™•ì¸

### ê²°ê³¼ ë³´ê³ 
ê° ë‹¨ê³„ ì™„ë£Œ í›„ ê²°ê³¼ë¥¼ ë¬¸ì„œí™”í•˜ì—¬ Phase 2 ì™„ì „ ì™„ë£Œ ì„ ì–¸

---

*ì´ ë¬¸ì„œëŠ” Question Diary Phase 2 ê°œë°œ ì™„ë£Œ ë³´ê³ ì„œì…ë‹ˆë‹¤.*
*ì‘ì„±ì¼: 2025ë…„ 9ì›” 25ì¼*
*ì‘ì„±ì: Claude Code*